(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[312],{27278:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var r=a(95155),s=a(12115),n=a(46673),l=a(83101),i=a(2821),o=a(75889);let d=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-500 text-white hover:bg-primary-600",destructive:"bg-red-500 text-white hover:bg-red-600",outline:"border border-gray-300 bg-transparent hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-800",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-100",link:"text-primary-500 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:c=!1,...h}=e,x=c?n.DX:"button";return(0,r.jsx)(x,{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.QP)((0,i.$)(t))}(d({variant:s,size:l,className:a})),ref:t,...h})});c.displayName="Button"},73989:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var r=a(95155),s=a(12115),n=a(98128),l=a(26991),i=a(68425),o=a(47734),d=a(74595),c=a(33420),h=a(37665),x=a(58155),m=a(80019),u=a(89585),g=a(66955),y=a(32320),f=a(1524),p=a(90368),j=a(27937),b=a(27278),v=a(78674),w=a(88901),k=a(1087),N=a(61256),D=a(77007),M=a(55041),z=a(76871),A=a(75946),S=a.n(A);function E(){let[e,t]=(0,s.useState)([]),[a,A]=(0,s.useState)([]),[E,C]=(0,s.useState)([]),[$,_]=(0,s.useState)("month"),[P,K]=(0,s.useState)(new Date),[L,O]=(0,s.useState)(!1),[Q,W]=(0,s.useState)("cloud"),F=(0,s.useRef)(null);(0,s.useEffect)(()=>{G()},[]),(0,s.useEffect)(()=>{e.length>0&&T()},[e,$,P]),(0,s.useEffect)(()=>{a.length>0&&"cloud"===Q&&F.current&&B()},[a,Q]);let G=async()=>{try{let e=await fetch("/api/diary");if(e.ok){let a=await e.json();t(a)}}catch(e){console.error("日記データの取得に失敗:",e)}},R=e=>{let t=new Set(["の","に","は","を","た","が","で","て","と","し","れ","さ","ある","いる","も","する","から","な","こと","として","い","や","れる","など","なっ","ない","この","ため","その","あっ","よう","また","もの","という","あり","まで","られ","なる","へ","か","だ","これ","によって","により","おり","より","による","ず","なり","ら","なく","しかし","について","だけ","だっ","それ","でも","でし","です","ます","ました","ません","でした","だった","って","ちょっと","いい","ので","けど","みたい","とか","だから","けれど","でき","きた","いた","あった","なんだか","かんだ","ながら","たら","すごく"]),a=e.match(/([一-龯]{1,3}|[ァ-ヴー]{2,4}|[ぁ-ん]{2,3})/g)||[];a.length<20&&(a=e.match(/([一-龯ぁ-んァ-ヴー]{2,5})/g)||[]);let r=new Map;return a.forEach(e=>{if(e.length>=1&&e.length<=3&&!t.has(e)&&!e.match(/^[ぁ-ん]+$/)){let t=r.get(e)||0;r.set(e,t+1)}}),Array.from(r.entries()).map(e=>{let[t,a]=e;return{word:t,count:a}}).sort((e,t)=>t.count-e.count).slice(0,50)},T=async()=>{O(!0);try{let t=[...e],a=new Date;switch($){case"month":let r=(0,v.w)(P),s=(0,w.p)(P);t=e.filter(e=>{let t=new Date(e.entryDate);return t>=r&&t<=s});break;case"3months":let n=(0,k.a)(a,3);t=e.filter(e=>new Date(e.entryDate)>=n);break;case"year":let l=(0,k.a)(a,12);t=e.filter(e=>new Date(e.entryDate)>=l)}let i=t.map(e=>e.content||"").join(" "),o=R(i);if(A(o),"3months"===$||"year"===$||"all"===$){let t=("year"===$?(0,N.i)({start:(0,k.a)(a,11),end:a}):"3months"===$?(0,N.i)({start:(0,k.a)(a,2),end:a}):(0,N.i)({start:new Date(Math.min(...e.map(e=>new Date(e.entryDate).getTime()))),end:a})).map(t=>{let a=(0,v.w)(t),r=(0,w.p)(t),s=e.filter(e=>{let t=new Date(e.entryDate);return t>=a&&t<=r}).map(e=>e.content||"").join(" "),n=R(s).slice(0,10);return{month:(0,D.GP)(t,"yyyy-MM",{locale:M.ja}),words:n}});C(t)}}catch(e){console.error("単語分析エラー:",e)}finally{O(!1)}},B=()=>{if(!F.current||0===a.length)return;z.Ltv(F.current).selectAll("*").remove();let e=z.m4Y().domain([1,Math.max(...a.map(e=>e.count))]).range([16,80]),t=z.UMr(z.DQM);S()().size([800,400]).words(a.map(t=>({...t,text:t.word,size:e(t.count)}))).padding(5).rotate(()=>(Math.random()-.5)*60).font("sans-serif").fontSize(e=>e.size).on("end",function(e){z.Ltv(F.current).attr("width",800).attr("height",400).append("g").attr("transform","translate(".concat(400,",").concat(200,")")).selectAll("text").data(e).enter().append("text").style("font-size",e=>"".concat(e.size,"px")).style("font-family","sans-serif").style("font-weight","bold").style("fill",(e,a)=>t(a.toString())).attr("text-anchor","middle").attr("transform",e=>"translate(".concat(e.x,",").concat(e.y,")rotate(").concat(e.rotate,")")).text(e=>e.text).style("cursor","pointer").on("mouseover",function(){z.Ltv(this).style("opacity",.7)}).on("mouseout",function(){z.Ltv(this).style("opacity",1)})}).start()},U=e=>{K(t=>{let a=new Date(t);return"prev"===e?a.setMonth(a.getMonth()-1):a.setMonth(a.getMonth()+1),a})};return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"単語分析"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"日記に登場する頻出単語を可視化します"}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"分析期間"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(b.$,{variant:"cloud"===Q?"default":"outline",size:"sm",onClick:()=>W("cloud"),children:[(0,r.jsx)(y.A,{className:"w-4 h-4 mr-1"}),"クラウド"]}),(0,r.jsxs)(b.$,{variant:"bar"===Q?"default":"outline",size:"sm",onClick:()=>W("bar"),children:[(0,r.jsx)(n.E,{className:"w-4 h-4 mr-1"}),"棒グラフ"]}),(0,r.jsxs)(b.$,{variant:"timeline"===Q?"default":"outline",size:"sm",onClick:()=>W("timeline"),disabled:"month"===$,children:[(0,r.jsx)(f.A,{className:"w-4 h-4 mr-1"}),"時系列"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("select",{value:$,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,r.jsx)("option",{value:"month",children:"月単位"}),(0,r.jsx)("option",{value:"3months",children:"過去3ヶ月"}),(0,r.jsx)("option",{value:"year",children:"過去1年"}),(0,r.jsx)("option",{value:"all",children:"全期間"})]}),"month"===$&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.$,{variant:"outline",size:"icon",onClick:()=>U("prev"),children:(0,r.jsx)(p.A,{className:"w-4 h-4"})}),(0,r.jsx)("span",{className:"px-3 py-2 text-gray-900 dark:text-white",children:(0,D.GP)(P,"yyyy年MM月",{locale:M.ja})}),(0,r.jsx)(b.$,{variant:"outline",size:"icon",onClick:()=>U("next"),disabled:P>=new Date,children:(0,r.jsx)(j.A,{className:"w-4 h-4"})})]})]})]}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:L?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"単語を分析中..."})]})}):0===a.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(y.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"この期間の日記データがありません"})]})}):(0,r.jsxs)(r.Fragment,{children:["cloud"===Q&&(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("svg",{ref:F})}),"bar"===Q&&(0,r.jsx)(l.u,{width:"100%",height:400,children:(0,r.jsxs)(n.E,{data:a.slice(0,20),children:[(0,r.jsx)(i.d,{strokeDasharray:"3 3"}),(0,r.jsx)(o.W,{dataKey:"word",angle:-45,textAnchor:"end",height:80}),(0,r.jsx)(d.h,{}),(0,r.jsx)(c.m,{}),(0,r.jsx)(h.s,{}),(0,r.jsx)(x.y,{dataKey:"count",fill:"#8b5cf6",name:"出現回数"})]})}),"timeline"===Q&&"month"!==$&&(0,r.jsx)(l.u,{width:"100%",height:400,children:(0,r.jsxs)(m.b,{data:(()=>{if(0===E.length||0===a.length)return[];let e=a.slice(0,5).map(e=>e.word);return E.map(t=>{let a={month:t.month};return e.forEach(e=>{let r=t.words.find(t=>t.word===e);a[e]=r?r.count:0}),a})})(),children:[(0,r.jsx)(i.d,{strokeDasharray:"3 3"}),(0,r.jsx)(o.W,{dataKey:"month"}),(0,r.jsx)(d.h,{}),(0,r.jsx)(c.m,{}),(0,r.jsx)(h.s,{}),a.slice(0,5).map((e,t)=>(0,r.jsx)(u.N,{type:"monotone",dataKey:e.word,stroke:z.DQM[t],strokeWidth:2},e.word))]})}),(0,r.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"頻出単語TOP20"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:a.slice(0,20).map((e,t)=>(0,r.jsxs)("span",{className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full text-sm",style:{fontSize:"".concat(Math.max(12,Math.min(20,12+e.count/2)),"px")},children:[e.word," (",e.count,")"]},e.word))})]})]})}),(0,r.jsxs)("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"単語分析について"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-400 space-y-1",children:[(0,r.jsx)("li",{children:"• 日記に頻繁に登場する単語を抽出して可視化します"}),(0,r.jsx)("li",{children:"• ワードクラウドでは、文字の大きさが出現頻度を表します"}),(0,r.jsx)("li",{children:"• 時系列グラフで、特定の単語の使用頻度の変化を追跡できます"}),(0,r.jsx)("li",{children:"• あなたの関心事や思考パターンの変化を発見できます"})]})]})]})}},79186:(e,t,a)=>{Promise.resolve().then(a.bind(a,73989))}},e=>{e.O(0,[407,112,143,198,826,629,441,255,977],()=>e(e.s=79186)),_N_E=e.O()}]);