(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{7559:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var s=a(95155),r=a(12115),l=a(26991),n=a(80019),i=a(68425),d=a(47734),c=a(74595),o=a(33420),x=a(37665),m=a(89585),h=a(77007),g=a(55041);let u={joy:"#FFD700",sadness:"#4682B4",trust:"#87CEEB",anticipation:"#FFA500",overall:"#6B7280"},y={joy:"喜び",sadness:"悲しみ",anger:"怒り",fear:"恐れ",surprise:"驚き",disgust:"嫌悪",trust:"信頼",anticipation:"期待",overall:"総合"};function j(e){let{data:t,period:a}=e,r="year"===a?t.filter((e,t)=>t%7==0):t;return(0,s.jsx)(l.u,{width:"100%",height:"100%",children:(0,s.jsxs)(n.b,{data:r.map(e=>({...e,date:(e=>{let t=new Date(e);return"week"===a?(0,h.GP)(t,"E",{locale:g.ja}):"month"===a?(0,h.GP)(t,"d日",{locale:g.ja}):(0,h.GP)(t,"M月",{locale:g.ja})})(e.date)})),margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(i.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,s.jsx)(d.W,{dataKey:"date",stroke:"#6b7280",style:{fontSize:"12px"}}),(0,s.jsx)(c.h,{stroke:"#6b7280",style:{fontSize:"12px"},domain:[0,100]}),(0,s.jsx)(o.m,{content:(0,s.jsx)(e=>{let{active:t,payload:a,label:r}=e;return t&&a&&a.length?(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:r}),a.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,s.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:[y[e.dataKey],":"]}),(0,s.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:Math.round(e.value)})]},e.dataKey))]}):null},{})}),(0,s.jsx)(x.s,{formatter:e=>y[e],wrapperStyle:{fontSize:"12px"}}),(0,s.jsx)(m.N,{type:"monotone",dataKey:"overall",stroke:u.overall,strokeWidth:3,dot:{r:4},activeDot:{r:6}}),(0,s.jsx)(m.N,{type:"monotone",dataKey:"joy",stroke:u.joy,strokeWidth:2,dot:!1,activeDot:{r:5}}),(0,s.jsx)(m.N,{type:"monotone",dataKey:"sadness",stroke:u.sadness,strokeWidth:2,dot:!1,activeDot:{r:5}}),(0,s.jsx)(m.N,{type:"monotone",dataKey:"trust",stroke:u.trust,strokeWidth:2,dot:!1,activeDot:{r:5}}),(0,s.jsx)(m.N,{type:"monotone",dataKey:"anticipation",stroke:u.anticipation,strokeWidth:2,dot:!1,activeDot:{r:5}})]})})}var v=a(12723),p=a(4035),f=a(69386);let b={joy:"#FFD700",sadness:"#4682B4",anger:"#DC143C",fear:"#8B008B",surprise:"#FF69B4",disgust:"#228B22",trust:"#87CEEB",anticipation:"#FFA500"},N={joy:"喜び",sadness:"悲しみ",anger:"怒り",fear:"恐れ",surprise:"驚き",disgust:"嫌悪",trust:"信頼",anticipation:"期待"};function w(e){let{data:t}=e,a=Object.entries(Object.keys(b).reduce((e,a)=>{let s=t.reduce((e,t)=>e+(t[a]||0),0);return{...e,[a]:s}},{})).map(e=>{let[t,a]=e;return{name:N[t],value:Math.round(a),color:b[t]}}).sort((e,t)=>t.value-e.value);return(0,s.jsx)(l.u,{width:"100%",height:"100%",children:(0,s.jsxs)(v.r,{children:[(0,s.jsx)(p.F,{data:a,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{cx:t,cy:a,midAngle:r,innerRadius:l,outerRadius:n,percent:i}=e;if(i<.05)return null;let d=Math.PI/180,c=l+(n-l)*.5,o=t+c*Math.cos(-r*d),x=a+c*Math.sin(-r*d);return(0,s.jsx)("text",{x:o,y:x,fill:"white",textAnchor:o>t?"start":"end",dominantBaseline:"central",className:"text-xs font-medium",children:"".concat((100*i).toFixed(0),"%")})},outerRadius:120,fill:"#8884d8",dataKey:"value",children:a.map((e,t)=>(0,s.jsx)(f.f,{fill:e.color},"cell-".concat(t)))}),(0,s.jsx)(o.m,{content:(0,s.jsx)(e=>{let{active:t,payload:a}=e;if(t&&a&&a.length){let e=a[0];return(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.payload.color}}),(0,s.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["合計: ",e.value.toLocaleString()]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["割合: ",(100*(e.percent||0)).toFixed(1),"%"]})]})}return null},{})}),(0,s.jsx)(x.s,{verticalAlign:"bottom",height:36,formatter:e=>e,wrapperStyle:{fontSize:"12px"}})]})})}var k=a(82192),D=a(51321),F=a(6180),M=a(35405);function C(e){let{data:t,period:a}=e,r=e=>e>=80?"bg-green-500":e>=60?"bg-green-400":e>=40?"bg-yellow-400":e>=20?"bg-orange-400":"bg-red-400",l=new Map(t.map(e=>[e.date,e.overall||0])),n=(()=>{let e=[],t=new Date,s=new Date;if("week"===a){s=(0,k.k)(t,{weekStartsOn:0});let a=(0,D.$)(t,{weekStartsOn:0}),r=(0,F.k)({start:s,end:a});e.push(r)}else if("month"===a){let a=new Date(t);for(a.setDate(t.getDate()-29);0!==a.getDay();)a.setDate(a.getDate()-1);let s=new Date(a);for(;s<=t;){let t=[];for(let e=0;e<7;e++){let a=new Date(s);a.setDate(s.getDate()+e),t.push(a)}e.push(t),s.setDate(s.getDate()+7)}}else{let e=[];for(let a=11;a>=0;a--){let s=new Date(t);s.setMonth(t.getMonth()-a),e.push(s)}return e}return e})();return"year"===a?(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"grid grid-cols-6 gap-2",children:n.map((e,a)=>{(0,h.GP)(e,"yyyy-MM-dd");let l=t.filter(t=>t.date.startsWith((0,h.GP)(e,"yyyy-MM"))),n=l.length>0?l.reduce((e,t)=>e+(t.overall||0),0)/l.length:0;return(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:(0,h.GP)(e,"M月",{locale:g.ja})}),(0,s.jsx)("div",{className:"w-full h-16 rounded ".concat(n>0?r(n):"bg-gray-200"," \n                    flex items-center justify-center text-white font-medium"),title:"平均: ".concat(n.toFixed(0)),children:n>0?Math.round(n):"-"})]},a)})})}):(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["日","月","火","水","木","金","土"].map(e=>(0,s.jsx)("div",{className:"text-center text-xs text-gray-500 font-medium",children:e},e))}),(0,s.jsx)("div",{className:"space-y-1",children:n.map((e,t)=>(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1",children:e.map((e,t)=>{let a=(0,h.GP)(e,"yyyy-MM-dd"),n=l.get(a)||0,i=(0,M.r)(e,new Date);return(0,s.jsx)("div",{className:"relative aspect-square rounded-lg ".concat(n>0?r(n):"bg-gray-100 dark:bg-gray-700"," ").concat(i?"ring-2 ring-blue-500":""),title:"".concat((0,h.GP)(e,"M/d"),": ").concat(n>0?Math.round(n):"データなし"),children:(0,s.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-white dark:text-gray-900",children:(0,h.GP)(e,"d")}),n>0&&(0,s.jsx)("div",{className:"text-xs text-white dark:text-gray-900 opacity-90",children:Math.round(n)})]})},t)})},t))}),(0,s.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-4",children:[(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"悪い"}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("div",{className:"w-4 h-4 bg-red-400 rounded"}),(0,s.jsx)("div",{className:"w-4 h-4 bg-orange-400 rounded"}),(0,s.jsx)("div",{className:"w-4 h-4 bg-yellow-400 rounded"}),(0,s.jsx)("div",{className:"w-4 h-4 bg-green-400 rounded"}),(0,s.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded"})]}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"良い"})]})]})}var S=a(1524),A=a(26921),B=a(7125),E=a(80534),z=a(83457),P=a(16485);function $(e){var t;let{stats:a}=e;return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"平均スコア"}),(0,s.jsx)(E.A,{className:"h-5 w-5 text-gray-400"})]}),(0,s.jsxs)("div",{className:"flex items-baseline",children:[(0,s.jsx)("span",{className:"text-3xl font-bold ".concat((t=a.averageScore)>=4?"text-green-600":t>=3?"text-yellow-600":"text-red-600"),children:a.averageScore.toFixed(1)}),(0,s.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"/ 5.0"})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-1",children:[(()=>{switch(a.trend){case"up":return(0,s.jsx)(S.A,{className:"h-5 w-5 text-green-500"});case"down":return(0,s.jsx)(A.A,{className:"h-5 w-5 text-red-500"});default:return(0,s.jsx)(B.A,{className:"h-5 w-5 text-gray-500"})}})(),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:(()=>{switch(a.trend){case"up":return"上昇傾向";case"down":return"下降傾向";default:return"安定"}})()})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"主要な感情"}),(0,s.jsx)(z.A,{className:"h-5 w-5 text-gray-400"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.dominantEmotion||"平穏"}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"最も頻繁に現れる感情"})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"記録数"}),(0,s.jsx)(P.A,{className:"h-5 w-5 text-gray-400"})]}),(0,s.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:a.totalEntries}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"期間内の日記数"})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"感情の安定度"}),(0,s.jsx)("div",{className:"h-5 w-5 rounded-full bg-gradient-to-r from-green-400 to-blue-500"})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"stable"===a.trend?"安定":"up"===a.trend?"改善中":"要注意"}),(0,s.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"全体的な傾向"})]})]})}var G=a(27278),K=a(87454),W=a(39867),O=a(50906);function _(){let[e,t]=(0,r.useState)("month"),[a,l]=(0,r.useState)("line"),[n,i]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[o,x]=(0,r.useState)({averageScore:0,dominantEmotion:"",totalEntries:0,trend:"stable"});(0,r.useEffect)(()=>{m()},[e]);let m=async()=>{c(!0);try{let t=await fetch("/api/emotions/aggregate?period=".concat(e));if(t.ok){let e=await t.json();i(e.chartData||[]),x(e.stats||{averageScore:0,dominantEmotion:"",totalEntries:0,trend:"stable"})}}catch(e){console.error("感情データの取得に失敗:",e)}finally{c(!1)}};return(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"感情分析ダッシュボード"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"あなたの感情の変化を可視化して、心の健康を見守ります"})]}),(0,s.jsx)($,{stats:o}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(G.$,{variant:"week"===e?"default":"outline",size:"sm",onClick:()=>t("week"),children:"週間"}),(0,s.jsx)(G.$,{variant:"month"===e?"default":"outline",size:"sm",onClick:()=>t("month"),children:"月間"}),(0,s.jsx)(G.$,{variant:"year"===e?"default":"outline",size:"sm",onClick:()=>t("year"),children:"年間"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(G.$,{variant:"line"===a?"default":"ghost",size:"icon",onClick:()=>l("line"),title:"折れ線グラフ",children:(0,s.jsx)(S.A,{className:"h-4 w-4"})}),(0,s.jsx)(G.$,{variant:"pie"===a?"default":"ghost",size:"icon",onClick:()=>l("pie"),title:"円グラフ",children:(0,s.jsx)(K.A,{className:"h-4 w-4"})}),(0,s.jsx)(G.$,{variant:"heatmap"===a?"default":"ghost",size:"icon",onClick:()=>l("heatmap"),title:"ヒートマップ",children:(0,s.jsx)(P.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)(G.$,{variant:"outline",size:"sm",className:"gap-2",children:[(0,s.jsx)(W.A,{className:"h-4 w-4"}),"エクスポート"]})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:d?(0,s.jsx)("div",{className:"h-96 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"データを読み込み中..."})]})}):0===n.length?(0,s.jsx)("div",{className:"h-96 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(O.A,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"まだデータがありません"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"日記を書くと感情分析が表示されます"})]})}):(0,s.jsxs)("div",{className:"h-96",children:["line"===a&&(0,s.jsx)(j,{data:n,period:e}),"pie"===a&&(0,s.jsx)(w,{data:n}),"heatmap"===a&&(0,s.jsx)(C,{data:n,period:e})]})}),"heatmap"!==a&&(0,s.jsxs)("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"感情の種類"}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{name:"喜び",color:"#FFD700"},{name:"悲しみ",color:"#4682B4"},{name:"怒り",color:"#DC143C"},{name:"恐れ",color:"#8B008B"},{name:"驚き",color:"#FF69B4"},{name:"嫌悪",color:"#228B22"},{name:"信頼",color:"#87CEEB"},{name:"期待",color:"#FFA500"}].map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name})]},e.name))})]})]})}},27278:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var s=a(95155),r=a(12115),l=a(46673),n=a(83101),i=a(2821),d=a(75889);let c=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-500 text-white hover:bg-primary-600",destructive:"bg-red-500 text-white hover:bg-red-600",outline:"border border-gray-300 bg-transparent hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-800",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-100",link:"text-primary-500 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:o=!1,...x}=e,m=o?l.DX:"button";return(0,s.jsx)(m,{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,d.QP)((0,i.$)(t))}(c({variant:r,size:n,className:a})),ref:t,...x})});o.displayName="Button"},54253:(e,t,a)=>{Promise.resolve().then(a.bind(a,7559))}},e=>{e.O(0,[407,112,143,826,527,441,255,977],()=>e(e.s=54253)),_N_E=e.O()}]);