(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{11188:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>v});var t=r(95155),s=r(12115),l=r(47260),n=r(27278),i=r(65229),o=r(71847);let c=(0,o.A)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function d(e){let{content:a,mood:r,tags:l,onContentChange:o,onMoodChange:d,onTagsChange:u}=e,[m,h]=s.useState(""),y=()=>{m.trim()&&!l.includes(m.trim())&&(u([...l,m.trim()]),h(""))};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"content",className:"block text-sm font-medium mb-2",children:"今日の出来事"}),(0,t.jsx)("textarea",{id:"content",value:a,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",rows:8,placeholder:"今日はどんな一日でしたか？"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"今日の気分"}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{value:"happy",label:"\uD83D\uDE0A 嬉しい"},{value:"sad",label:"\uD83D\uDE22 悲しい"},{value:"angry",label:"\uD83D\uDE20 怒り"},{value:"excited",label:"\uD83C\uDF89 興奮"},{value:"calm",label:"\uD83D\uDE0C 穏やか"},{value:"anxious",label:"\uD83D\uDE30 不安"}].map(e=>(0,t.jsx)(n.$,{type:"button",variant:r===e.value?"default":"outline",onClick:()=>d(e.value),className:"w-full",children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"タグ"}),(0,t.jsx)("div",{className:"flex gap-2 mb-2 flex-wrap",children:l.map(e=>(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-full text-sm",children:[e,(0,t.jsx)("button",{type:"button",onClick:()=>{u(l.filter(a=>a!==e))},className:"hover:text-primary-900 dark:hover:text-primary-100",children:(0,t.jsx)(i.A,{className:"h-3 w-3"})})]},e))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),y()),placeholder:"タグを追加",className:"flex-1 px-3 py-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-primary-500"}),(0,t.jsx)(n.$,{type:"button",onClick:y,variant:"outline",size:"icon",children:(0,t.jsx)(c,{className:"h-4 w-4"})})]})]})]})}var u=r(35299),m=r(18085),h=r(42529);function y(e){let{onComplete:a}=e,[r,l]=(0,s.useState)([{role:"assistant",content:"今日はどんな一日でしたか？何か印象に残ったことがあれば教えてください。"}]),[i,o]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),[y,g]=(0,s.useState)(!1),x=async()=>{if(!i.trim()||c)return;let e={role:"user",content:i};l(a=>[...a,e]),o(""),d(!0);try{let e=await fetch("/api/ai/dialogue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,conversationHistory:r})});if(e.ok){let a=await e.json();l(e=>[...e,{role:"assistant",content:a.response}])}}catch(e){console.error("対話エラー:",e),l(e=>[...e,{role:"assistant",content:"申し訳ありません。応答の生成中にエラーが発生しました。"}])}finally{d(!1)}},p=async()=>{if(!(r.length<2)){g(!0);try{let e=await fetch("/api/ai/dialogue/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:r})});if(e.ok){let r=await e.json();a(r.content,r.mood,r.tags)}}catch(e){console.error("要約エラー:",e)}finally{g(!1)}}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 h-96 overflow-y-auto space-y-4",children:[r.map((e,a)=>(0,t.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,t.jsx)("div",{className:"max-w-[80%] rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-primary-500 text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white"),children:e.content})},a)),c&&(0,t.jsx)("div",{className:"flex justify-start",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg px-4 py-2",children:(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin"})})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&x(),placeholder:"メッセージを入力...",disabled:c||y,className:"flex-1 px-4 py-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"}),(0,t.jsx)(n.$,{onClick:x,disabled:!i.trim()||c||y,children:(0,t.jsx)(m.A,{className:"h-4 w-4"})})]}),r.length>2&&(0,t.jsxs)(n.$,{onClick:p,disabled:y,className:"w-full",variant:"outline",children:[y?(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,t.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"対話を終了して日記を作成"]})]})}let g="diary_draft",x=(0,o.A)("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var p=r(37586);let f=(0,o.A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var b=r(95740);function v(){let e=(0,l.useRouter)(),[a,r]=(0,s.useState)("freewrite"),[i,o]=(0,s.useState)(""),[c,m]=(0,s.useState)("calm"),[h,v]=(0,s.useState)(["日常","振り返り"]),[k,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(null),{draft:A,saveDraft:S,clearDraft:C}=function(){let[e,a]=(0,s.useState)(null),r=()=>{try{let e=localStorage.getItem(g);if(e){let r=JSON.parse(e);return a(r),r}}catch(e){console.error("下書きの読み込みに失敗しました:",e)}return null};return(0,s.useEffect)(()=>{r()},[]),{draft:e,loadDraft:r,saveDraft:e=>{try{localStorage.setItem(g,JSON.stringify(e)),a(e)}catch(e){console.error("下書きの保存に失敗しました:",e)}},clearDraft:()=>{try{localStorage.removeItem(g),a(null)}catch(e){console.error("下書きのクリアに失敗しました:",e)}}}}();(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/init-user");if(e.ok){let a=await e.json();N(a.user)}}catch(e){console.error("ユーザー初期化エラー:",e)}})()},[]),(0,s.useEffect)(()=>{A&&(o(A.content||""),m(A.mood||"calm"),v(A.tags||["日常","振り返り"]),A.mode&&r(A.mode))},[A]),function(e){let{data:a,onSave:r,interval:t=3e4,enabled:l=!0}=e,n=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(l)return n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r(a)},t),()=>{n.current&&clearTimeout(n.current)}},[a,r,t,l])}({data:{content:i,mood:c,tags:h,mode:a},onSave:e=>S(e),interval:3e4,enabled:"freewrite"===a&&i.length>0});let z=async()=>{if(i.trim()){j(!0);try{let a=await fetch("/api/diary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:i,mood:c,tags:h})});if(a.ok){let r=await a.json();C(),e.push("/mindmap?diaryId=".concat(r.id))}}catch(e){console.error("保存エラー:",e)}finally{j(!1)}}};return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"新しい日記を書く"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"今日の出来事や気持ちを記録しましょう"})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,t.jsxs)(n.$,{variant:"freewrite"===a?"default":"outline",onClick:()=>r("freewrite"),className:"flex-1",children:[(0,t.jsx)(x,{className:"h-4 w-4 mr-2"}),"自由に書く"]}),(0,t.jsxs)(n.$,{variant:"interactive"===a?"default":"outline",onClick:()=>r("interactive"),className:"flex-1",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"対話しながら書く"]})]}),"freewrite"===a?(0,t.jsx)(d,{content:i,mood:c,tags:h,onContentChange:o,onMoodChange:m,onTagsChange:v}):(0,t.jsx)(y,{onComplete:(e,a,t)=>{o(e),m(a),v(t),r("freewrite")}})]}),"freewrite"===a&&(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.$,{onClick:z,disabled:!i.trim()||k,className:"flex-1",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2 animate-spin"}),"保存中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f,{className:"h-4 w-4 mr-2"}),"日記を保存"]})}),(0,t.jsx)(n.$,{variant:"outline",onClick:()=>{o(""),m("calm"),v(["日常","振り返り"]),C()},children:"クリア"})]}),"freewrite"===a&&i.length>0&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4 text-center",children:[(0,t.jsx)(b.A,{className:"inline h-3 w-3 mr-1"}),"下書きは自動的に保存されます"]})]})}},18085:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},27278:(e,a,r)=>{"use strict";r.d(a,{$:()=>d});var t=r(95155),s=r(12115),l=r(46673),n=r(83101),i=r(2821),o=r(75889);let c=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-500 text-white hover:bg-primary-600",destructive:"bg-red-500 text-white hover:bg-red-600",outline:"border border-gray-300 bg-transparent hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-800",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-100",link:"text-primary-500 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,a)=>{let{className:r,variant:s,size:n,asChild:d=!1,...u}=e,m=d?l.DX:"button";return(0,t.jsx)(m,{className:function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,o.QP)((0,i.$)(a))}(c({variant:s,size:n,className:r})),ref:a,...u})});d.displayName="Button"},35299:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},37586:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},42529:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},51838:(e,a,r)=>{Promise.resolve().then(r.bind(r,11188))},65229:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},95740:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])}},e=>{e.O(0,[407,441,255,977],()=>e(e.s=51838)),_N_E=e.O()}]);